{% extends 'pos/base.html' %}
{% load staticfiles %}
{% block content %}
<!-- Include meta tag to ensure proper rendering and touch zooming -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<div class="flex-container">
  <div class="flex-left">
    {% for row in rows %}
      {% for loc in row %}
        {% if loc.1 == 0 %}
          <div class="row">
            <div class="col row-description"><strong>{{ loc.2 }}</strong></div>
          </div>
          <div class="row row-buttons">
        {% else %}

          <div class="col col-md-2">
            {% if loc.2 %}
{#              <button class="posbutton timed" id="{{ loc.2.id }}"#}
{#                      style="background-color: {{ loc.2.colour.back_colour }};#}
{#                          color: {{ loc.2.colour.fore_colour }}">#}
{#                <span>{{ loc.2.button_text }}</span>#}
{#              </button>#}
              <input type="submit" class="posbutton timed" id="{{ loc.2.id }}"
                      style="background-color: {{ loc.2.colour.back_colour }};
                          color: {{ loc.2.colour.fore_colour }};"
                value="{{ loc.2.button_text }}">
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
      </div>
      <br/>
    {% endfor %}
  </div>

  <div class="flex-right">
    <div class="name-area">
      {{ full_name }}
    </div>
    <div id="receipt-area">
      <table id="id_table">

      </table>
    </div>
    <div id="total-area"></div>
    <div id="id_payment">
      <div class="col-md-6 buttons-active">
        <button class="btn btn-warning btn-lg btn-block timed" id="id_pay" onclick="posCode.pay()">
          Payment
        </button>
      </div>
      <div class="col-md-6 buttons-active">
        <button class="btn btn-danger btn-lg btn-block timed" id="id_cancel" onclick="posCode.newReceipt()">
          Cancel all
        </button>
      </div>
      <div class="col-md-12 button-exit">
        <button class="btn btn-lg btn-block btn-warning" id="id_exit" onclick="posCode.exitPos()">
          Exit
        </button>
      </div>
    </div>
  </div>
</div>

  <div class="terminal">Terminal: {{ terminal }}</div>

<!-- Modal for attended mode -->
<div id="attended_modal" class="modal" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h3 class="modal-title">Select payment type</h3>
        </div>
        <div class="modal-body">
          <h4>Total is <span id="attended_total">xxx</span></h4>
        </div>
        <div class="modal-footer">
          <button class="btn btn-lg btn-success" id="account" data-dismiss="modal" onclick="posCode.account()">
            Charge to member account
          </button>
          <button class="btn btn-lg btn-success" id="cash" data-dismiss="modal" onclick="posCode.cash()">
            Cash sale
          </button>
          <button class="btn btn-lg btn-danger" data-dismiss="modal" id="back" onclick="posCode.resume()">
            Back
          </button>
        </div>
    </div>
  </div>
</div>

<!-- Modal for member mode -->
<div id="member_modal" class="modal" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h3 class="modal-title">Charge to account</h3>
      </div>
      <div class="modal-body">
        <h3>Confirm charge of <span id="member_total"></span> to <span id="member_name"></span></h3>
      </div>
      <div class="modal-footer">
        <button class="btn btn-lg btn-success" data-dismiss="modal" onclick="posCode.commitSingle()">
          Charge to account
        </button>
        {% if person_id != -1 %}
        <button class="btn btn-lg btn-success" data-dismiss="modal" onclick="posCode.split()">
          Split account
        </button>
        {% endif %}
        <button class="btn btn-lg btn-danger" data-dismiss="modal" onclick="posCode.resume()">
          Back
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal to select and charge to members account -->
<div id="select_modal" class="modal" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h3 class="modal-title" id="modal_title">
          <span id="title_1"></span> <span id="title_total"></span> <span id="title_2"></span>
        </h3>
      </div>
      <div class="modal-body">
        <table id="peopleTable">
        </table>
      </div>
      <div class="modal-footer">
        <div id="add_member_typeahead" class="row">
          <div class="col-md-4 ipad-prompt">Select member:</div>
          <div class="col-md-5">
            <div class="input-group input-group-lg">
              <input type="text" class="form-control  timed" id="member_search"
                     autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
            </div>
          </div>
          <div class="col-md-3">
            <button class="btn btn-lg btn-danger" onclick="posCode.back1()">
              Back
            </button>
          </div>
        </div>
        <div id="pay_buttons">
          <button class="btn btn-lg btn-success"  data-dismiss="modal" id="chargeMemberBtn" onclick="posCode.commit()">
            Charge to account
          </button>
          <button class="btn btn-lg btn-success" id="add_member_btn" onclick="posCode.addMember()">
            Add another member
          </button>
          <button class="btn btn-lg btn-danger" data-dismiss="modal" onclick="posCode.back1()">
            Back
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script src= {% static 'js/typeahead.bundle.js' %}></script>
<script src="{% static 'pos/js/pos-typeahead.js' %}"></script>
<script src="{% static 'pos/js/pos2.js' %}"></script>
<script>
  $(document).ready(function () {
    posCode.init('{{ items_url }}', '{{ post_url }}', '{{ exit_url }}', {{ is_attended }},
        '{{ person_id }}', '{{ full_name }}', '{{ csrf_token }}', timingCode);
    timingCode.startTimer({{ timeout }}, "{{ timeout_url }}");
    bind_typeahead('#member_search', posCode.selectedPerson, true);
});
</script>
{% endblock %}
