{% extends 'pos/base.html' %}
{% load static %}
{% block content %}

  {%  include '_logo_banner.html' %}

  <div class="container">
  <div class="text-center bg {% if is_bar %}jumbotron{% endif %}">
    <h1 class="text-center"><strong>
      {% if is_bar %}Honesty Bar{% else %}Online Member Services{% endif %}</strong></h1>
    <br>
    <div id="idOnlineMessage"> <!-- division is hidden if ping fails -->
      <div class="row">
        <p class="ipad-error">{{ request.session.message }}</p>
        <form method="post">{% csrf_token %}
          {% if is_bar %}
            {% for app in apps %}
{#              <button class="posbutton btn-large btn-block" type="submit" name="app_{{ app.id }}">{{ app.name }}</button>#}
              <button type="button" class="posbutton btn-large btn-block" onclick="startBar()" name="app_{{ app.id }}">CLICK ME</button>
            {% endfor %}
            {% if attended %}
              <br/><br/><br/>
              <input class="posbutton btn-large" type="submit" name="attended" value="Attended mode">
            {% endif %}
             <br><br>
          {% else %}
            <div class="row">
              <div class="col-md-4">
                {% for app in apps %}
                  {% if app.event %}
                    <input type="image" name="event_{{ app.event.id }}" src="{{ app.event.image.url }}" class="img-responsive">
                    <h3>Touch the picture to book</h3>
                  {% endif %}
                {% endfor %}
              </div>
              <div class="col-md-8">
                {% for app in apps %}
                  {% if not app.event %}
                    <div class="row">
                      <div class="col-md-6 text-center">
                        <button class="posbutton btn-large btn-block" type="submit" name="app_{{ app.id }}">{{ app.name }}</button>
                      </div>
                      <div class="col-md-6">
                        <p class="hint">{{ app.description }}</p>
                      </div>
                    </div>
                    <br>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
          {% endif %}
          <br>
        </form>
      </div>

      <p class="hint">All members who have paid their subscription can use this system after registration.<br>
          You can register now by pressing any button above and searching for your name.</p>
    </div>
    <p id="idOfflineMessage">Sorry, the server is offline. Please try later.</p><!-- division is visible if ping fails -->
  </div>
</div>
<div class="terminal">Terminal: {{ request.session.terminal }}
  <span id="idOnline"></span></div>
<div class="last-transaction">
  Last transaction: {{ request.session.last_person }}: £ {{ request.session.last_total }}
</div>
{% endblock %}
{% block scripts %}
<script>
  $(document).ready(function () {
    $(".posbutton").on('touchstart', function(event) {
      event.currentTarget.classList.add('posbutton-down');
    });
    $(".posbutton").on('touchend', function(event) {
      event.currentTarget.classList.remove('posbutton-down');
    });
    //timingCode.initPing({{ timeout }}, '{{ ping_url }}', '{{ csrf_token }}', '{{ request.session.terminal }}', 'idMessage');
  });
  function startBar() {
      console.log('Start bar');
      $('#idOfflineMessage').show().text('Ready');
              $.ajax({
            type: "POST",
            url: '/pos/start/',
            data: '',
            timeout: 10000,
            beforeSend: function (xhr, settings) {
                xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
            },
            success: function (data, status, xhr) {
                $('#idOfflineMessage').show().text('Button press was successful');
            },
            error: function (data, status, xhr) {
                $('#idOfflineMessage').show().text('Got an error');
            }
        });
  }
</script>
{% endblock %}