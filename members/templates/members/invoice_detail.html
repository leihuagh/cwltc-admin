{% extends "members/layout.html" %}
{% load members_extras %}

{% block content %}
<h4>
<a href="{% url "person-detail"  person.id %}">{{ person.first_name }} {{ person.last_name }}</a>
</h4>
<hr />
{% include "members/_invoice_detail.html" %}
<hr />
<p>Membership year : {{ invoice.membership_year }}</p>
<p>State: {{ state_list|get_option:invoice.state }}</p>

{% if invoice.gocardless_bill_id %}
    <h4>GoCardless Id: {{ invoice.gocardless_bill_id }}</h4>
    <table class="table">
        <tr><th>Date</th><th>Action</th><th>Processed</th><th>Error</th></tr>
    {% for hook in hooks %}
        <tr>
        <td><a href="{% url "webhook-detail" pk=hook.id %}">{{ hook.creation_date }}</a></td>
        <td>{{ hook.action }}</td>
        <td>{{ hook.processed}}</td>
        <td>{{ hook.error}}</td>
        </tr>
    {% endfor %}
    </table>

{% endif %}
    

{% if credit_note %}
    <p>Credit note: {{ credit_note.id }} </p>
    <p>Issued: {{ credit_note.update_date}}</p>
    <p>Amount: {{ credit_note.amount }}</p>
    <p>{{ credit_note.reference }}</p>
{% endif %}
<p>Email count: {{ invoice.email_count }} </p>
<p>Posted count: {{ invoice.postal_count }} </p>
<hr />
<form action="." method="post" class="form-inline" id="post-form">
    {% csrf_token %}
{% if full_payment_button %}
Email text blocks:
    <a href="{% url "text-update" pk=text_intro.id %}">{{ text_intro }}</a>, 
    <a href="{% url "text-update" pk=text_notes.id %}">{{ text_notes }}</a>, 
    <a href="{% url "text-update" pk=text_closing.id %}">{{ text_closing }}</a>
<br /><br />
    <a href="{% url "invoice-mail-config" pk=invoice.id %}" class="btn btn-primary">Configure mail</a>
    <input type="submit" name="view" value="Preview mail" class="btn btn-primary">
    <input type="submit" name="test" value="Send test mail" class="btn btn-primary">
    <input type="submit" name="send" value="send mail" class="btn btn-primary"> 
<br />    <br /> 
    <input type="submit" name="pay" value="Full payment" class="btn btn-success"> 
    <input type="submit" name="cancel" value="Cancel invoice" class="btn btn-danger"> 
{% endif %}
{% if can_delete %}
    <input type="submit" name="delete" value="Delete invoice" class="btn btn-danger"> 
{% endif %}
</form>
{% endblock content %}
